services:
  changedetection:
    image: ghcr.io/dgtlmoon/changedetection.io@sha256:e95931043d68da46e90498ce74ad317b392caade07186dc06bdfa1710901bf90
    container_name: changedetection
    networks:
      - proxy
    hostname: changedetection
    volumes:
      - /apps/changedetection:/datastore
    labels:
      - traefik.enable=true
      - traefik.http.routers.changedetection.rule=Host(`changedetection.{{ TRAEFIK_HOST_DOMAIN }}`)
      - traefik.http.routers.changedetection.entrypoints=https
      - traefik.http.routers.changedetection.middlewares=default-headers@file
      - traefik.http.routers.changedetection.tls=true
      - traefik.http.routers.changedetection.service=changedetection
      - traefik.http.services.changedetection.loadbalancer.server.port=5000
    environment:
      - LOGGER_LEVEL=DEBUG
      - BASE_URL=https://changedetection.{{ TRAEFIK_HOST_DOMAIN }}
      - USE_X_SETTINGS=1
      - HIDE_REFERER=true
      - DISABLE_VERSION_CHECK=true
      - TZ={{ host_timezone }}
      - PLAYWRIGHT_DRIVER_URL=ws://browser-sockpuppet-chrome:3000
    restart: unless-stopped

  browser-sockpuppet-chrome:
    hostname: browser-sockpuppet-chrome
    networks:
      - proxy
    image: dgtlmoon/sockpuppetbrowser@sha256:7116c61ef9cfce3d48a7efd9355d2fbe19f593ea3cfb52a5ded40ecbcb0a3f9d
    cap_add:
      - SYS_ADMIN
    restart: unless-stopped
    environment:
      - SCREEN_WIDTH=1920
      - SCREEN_HEIGHT=1024
      - SCREEN_DEPTH=16
      - MAX_CONCURRENT_CHROME_PROCESSES=10
